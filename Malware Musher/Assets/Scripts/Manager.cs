using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;
using UnityEngine.UI;
using TMPro;

public class Manager : MonoBehaviour {

    [Header("GameObjects")]
    public GameObject gameOver;
    public GameObject menu;
    public GameObject loadingBar;
    public GameObject win;
    [Header("UI Elements")]
    public Slider slider;
    public TMP_Text gunCooldown;
    public TMP_Text laserCooldown;
    public TMP_Text playerHealth;
    [Header("Scripts")]
    public Gun gun;
    public Laser laser;
    public PlayerHealth playerHealthScript;

    public void Start() {
        Time.timeScale = 1f;
    }

    public void Update() {
        if (gun.timeLeft < gun.cooldownTime) {
            gunCooldown.text = "Gun: " + (Mathf.Round(gun.timeLeft * 100)) / 100;
        } else {
            gunCooldown.text = "Gun: Ready!";
        }
        if (laser.timeLeft < laser.cooldownTime) {
            laserCooldown.text = "Laser: " + (Mathf.Round(laser.timeLeft * 100)) / 100;
        } else {
            laserCooldown.text = "Laser: Ready!";
        }
        playerHealth.text = "Health: " + playerHealthScript.health;
    }

    public void GameOver() {
        gameOver.SetActive(true);
        Time.timeScale = 0f;
    }

    public void Retry() {
        gameOver.SetActive(false);
        Scene scene = SceneManager.GetActiveScene();
        StartCoroutine(LoadSceneAsync(scene.buildIndex));
    }

    public void Win() {
        win.SetActive(true);
        Time.timeScale = 0f;
    }

    public void Continue()  {
        Scene scene = SceneManager.GetActiveScene();
        int index = scene.buildIndex;
        index++;
        StartCoroutine(LoadSceneAsync(index));
    }

    IEnumerator LoadSceneAsync(int sceneInt) {
        AsyncOperation asyncLoad = SceneManager.LoadSceneAsync(sceneInt);
        menu.SetActive(false);
        loadingBar.SetActive(true);
        while (!asyncLoad.isDone) {
            float progress = Mathf.Clamp01(asyncLoad.progress / 0.9f);
            slider.value = progress;
            yield return null;
        }
    }
}
