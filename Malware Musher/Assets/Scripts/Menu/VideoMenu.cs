using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using TMPro;

public class VideoMenu : MenuScript {

    public TMP_Dropdown resolutionDropdown;
    public TMP_Dropdown qualityDropdown;
    public Toggle fullscreenToggle;
    public Toggle postProcessingToggle;
    public BoolObject vfxEnabled;

    [HideInInspector]
    public List<string> resolutions;
    [HideInInspector]
    public List<int> indexes;
    [HideInInspector]
    public List<string> qualitySettings;
    private int refreshRate;
    private int resolutionIndex;

    public override void Start() {
        base.Start();
        fullscreenToggle.onValueChanged.AddListener(SetFullScreen);
        fullscreenToggle.isOn = Screen.fullScreen;
        postProcessingToggle.onValueChanged.AddListener(SetPostProcessing);
        postProcessingToggle.isOn = vfxEnabled.Value;
        resolutionDropdown.ClearOptions();
        for (int i = 0; i < Screen.resolutions.Length; i++) {
            if (Screen.resolutions[i].refreshRate > refreshRate) {
                refreshRate = Screen.resolutions[i].refreshRate;
            }
        }
        for (int i = 0; i < Screen.resolutions.Length; i++) {
            if (Screen.resolutions[i].refreshRate == refreshRate) {
                string resolutionString = Screen.resolutions[i].width + " x " + Screen.resolutions[i].height;
                resolutions.Add(resolutionString);
                indexes.Add(i);
                if ((Screen.currentResolution.width == Screen.resolutions[i].width) && (Screen.currentResolution.height == Screen.resolutions[i].height)) {
                    Debug.Log("Found resolution");
                    resolutionIndex = indexes.IndexOf(i);
                }
            }
        }
        resolutionDropdown.AddOptions(resolutions);
        resolutionDropdown.value = resolutionIndex;
        resolutionDropdown.RefreshShownValue();
        resolutionDropdown.onValueChanged.AddListener(SetResolution);

        qualitySettings.AddRange(QualitySettings.names);
        qualityDropdown.ClearOptions();
        qualityDropdown.AddOptions(qualitySettings);
        qualityDropdown.value = QualitySettings.GetQualityLevel();
        qualityDropdown.RefreshShownValue();
        qualityDropdown.onValueChanged.AddListener(SetQualitySetting);
    }

    public void SetFullScreen(bool fullscreen) {
        Screen.fullScreen = fullscreen;
    }

    public void SetQualitySetting(int index) {
        QualitySettings.SetQualityLevel(index, true);
    }

    public void SetPostProcessing(bool postProcessing) {
        vfxEnabled.Value = postProcessing;
    }

    public void SetResolution(int index) {
        Screen.SetResolution(Screen.resolutions[indexes[index]].width, Screen.resolutions[indexes[index]].height, fullscreenToggle.isOn, refreshRate);
    }
}
