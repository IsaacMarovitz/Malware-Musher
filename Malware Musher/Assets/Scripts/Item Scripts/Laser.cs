using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Laser : WeaponScript {

    public LayerMask layerMask;
    public LaserObject laserObject;
    private Vector3 shootDirection;
    private LaserObject objectCheck;

    void Start() {
        timeLeft = cooldownTime;
        if (laserObject != null) {
            objectCheck = laserObject;
        }
    }

    public void Update() {
        if (laserObject != null) {
            if (laserObject != objectCheck) {
                laserObject.Initialise(gameObject);
                objectCheck = laserObject;
            }
            if (Input.GetButtonDown("Fire2")) {
                Shoot();
            }
            if (!cooldownComplete) {
                timeLeft = Time.time - startTime;
            }
        }
    }

    public override void Shoot() {
        if (cooldownComplete)  {
            shootDirection = Input.mousePosition;
            shootDirection.z = 0.0f;
            shootDirection = Camera.main.ScreenToWorldPoint(shootDirection);
            shootDirection = shootDirection - transform.position;

            RaycastHit2D info = Physics2D.Raycast(transform.position, shootDirection, Mathf.Infinity, layerMask);
            Debug.DrawRay(transform.position, shootDirection, Color.black, 2f);
            if (info && info.transform.tag == "Enemy") {
                info.transform.GetComponent<EnemyHealth>().TakeDamage(damageDelt);
            }
            cooldownComplete = false;
            startTime = Time.time;
            StartCoroutine(Cooldown());
        }
    }
}
