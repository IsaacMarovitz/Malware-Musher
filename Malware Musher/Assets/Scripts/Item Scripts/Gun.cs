using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Gun : MonoBehaviour {

    public GameObject bulletPrefab;
    public Transform firePoint;
    // public GunObject gunObject;
    // private GunObject objectCheck;

    public float cooldownTime;
    public float timeLeft;
    public bool cooldownComplete = true;
    public float startTime;
    public int damageDelt;
    private AudioSource audioSource;
    public AudioClip gunSound;

    void Start() {
        audioSource = GetComponent<AudioSource>();
        timeLeft = cooldownTime;
        // if (gunObject != null) {
        //     objectCheck = gunObject;
        // }
    }

    public void Update() {
        // if (gunObject != null) {
            // if (gunObject != objectCheck) {
            //     gunObject.Initialise(gameObject);
            //     objectCheck = gunObject;
            // }
            if (Input.GetButtonDown("Fire1")) {
                Shoot();
            }
            if (!cooldownComplete) {
                timeLeft = Time.time - startTime;
            }
        // }
    }

    public void Shoot() {
        if (cooldownComplete) {
            audioSource.PlayOneShot(gunSound);
            GameObject bullet = Instantiate(bulletPrefab, firePoint.position, firePoint.rotation);
            bullet.GetComponent<Bullet>().FromPlayer();
            bullet.GetComponent<Bullet>().damageDelt = damageDelt;
            cooldownComplete = false;
            startTime = Time.time;
            StartCoroutine(Cooldown());
        }
    }

    public IEnumerator Cooldown() {
        yield return new WaitForSeconds(cooldownTime);
        cooldownComplete = true;
    }
}
