using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class Gun : MonoBehaviour {

    public GameObject bulletPrefab;
    public Transform firePoint;

    public float cooldownTime;
    public float timeLeft;
    public bool cooldownComplete = true;
    public float startTime;
    public int damageDelt;
    public AudioClip gunSound;

    private AudioSource audioSource;
    private bool canShoot;

    void Start() {
        audioSource = GetComponent<AudioSource>();
        timeLeft = cooldownTime;
        canShoot = true;
    }

    public void Update() {
        if (canShoot) {
            if (Input.GetButtonDown("Fire1")) {
                Shoot();
            }
        }
        if (!cooldownComplete) {
            timeLeft = Time.time - startTime;
        }
    }

    public void FreezeShoot() {
        canShoot = false;
    }

    public void UnFreezeShoot() {
        canShoot = true;
    }

    public void Shoot() {
        if (cooldownComplete) {
            audioSource.PlayOneShot(gunSound);
            GameObject bullet = Instantiate(bulletPrefab, firePoint.position, firePoint.rotation);
            bullet.GetComponent<Bullet>().FromPlayer();
            bullet.GetComponent<Bullet>().damageDelt = damageDelt;
            cooldownComplete = false;
            startTime = Time.time;
            StartCoroutine(Cooldown());
        }
    }

    public IEnumerator Cooldown() {
        yield return new WaitForSeconds(cooldownTime);
        cooldownComplete = true;
    }
}
