using System.Collections;
using UnityEngine;
using UnityEngine.SceneManagement;

public class GameManager : MonoBehaviour {

    public static GameManager Instance { get; private set; }
    //public LevelObjectClass[] levelObjects;

    private int currentSceneIndex;
    private int levelObjectsIndex;
    private LevelObjectClass levelObject;
    private bool sceneIsLoaded = false;

    private void Awake() {
        if (Instance == null) {
            Instance = this;
            DontDestroyOnLoad(gameObject);
        } else {
            Destroy(gameObject);
        }
    }

    void Update() {
        if (sceneIsLoaded) {
            StartCoroutine(LoadSceneAsyncAdditive());
            sceneIsLoaded = false;
        }
    }

    void OnEnable() {
        SceneManager.sceneLoaded += OnSceneLoaded;
    }

    void OnSceneLoaded(Scene scene, LoadSceneMode mode) {
        if (scene.name != "LevelEssentials") {
            currentSceneIndex = SceneManager.GetActiveScene().buildIndex;
            /*for (int i = 0; i < levelObjects.Length; i++) {
                if (levelObjects[i].sceneIndex == currentSceneIndex) {
                    levelObject = levelObjects[i];
                    levelObjectsIndex = i;
                    break;
                }
            }*/
            sceneIsLoaded = true;
        }
    }

    public void OnSceneWin() {
        /*levelObjects[levelObjectsIndex].hasBeenCompleted = true;
        if (levelObjectsIndex < levelObjects.Length - 1) {
            levelObjects[levelObjectsIndex + 1].hasBeenUnlocked = true;
        }*/
    }

    public void OnSceneDeath() {
    }

    IEnumerator LoadSceneAsyncAdditive() {
        AsyncOperation asyncLoad = SceneManager.LoadSceneAsync("LevelEssentials", LoadSceneMode.Additive);
        while (!asyncLoad.isDone) {
            yield return null;
        }
    }
}
