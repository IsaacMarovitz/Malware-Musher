using System.Collections;
using UnityEngine;
using UnityEngine.UI;
using TMPro;

public class PlayerUI : MonoBehaviour {

    public GameObject hud;
    public TMP_Text playerHealthText;
    public TMP_Text playerDamageText;
    public Slider playerHealthSlider;
    public Slider gunCooldown;
    public Slider laserCooldown;
    public float showDamageFor;

    private LevelManager levelManager;
    private PlayerHealth playerHealth;
    private Gun gun;
    private Laser laser;

    public void Start() {
        levelManager = FindObjectOfType<LevelManager>();
        playerHealth = this.gameObject.GetComponent<PlayerHealth>();
        gun = this.gameObject.GetComponent<Gun>();
        laser = this.gameObject.GetComponent<Laser>();
        playerHealthSlider.maxValue = playerHealth.maxHealth;
        playerHealthSlider.value = playerHealth.health;
        gunCooldown.maxValue = gun.cooldownTime;
        laserCooldown.maxValue = laser.cooldownTime;
        levelManager.pauseEvent += OnPause;
        levelManager.unPauseEvent += OnUnPause;
        levelManager.winEvent += OnWin;
        levelManager.deathEvent += OnDeath;
        playerHealth.damageEvent += UpdateDamageUI;
    }

    public void Update() {
        gunCooldown.value = (Mathf.Round(gun.timeLeft * 100)) / 100;
        laserCooldown.value = (Mathf.Round(laser.timeLeft * 100)) / 100;
        playerHealthText.text = "HP: " + playerHealth.health;
        playerHealthSlider.value = playerHealth.health;
    }

    public void OnPause() {
        hud.SetActive(false);
        gun.cooldownComplete = false;
        laser.cooldownComplete = false;
    }

    public void OnUnPause() {
        hud.SetActive(true);
    }

    public void OnWin() {
        gun.cooldownComplete = false;
        laser.cooldownComplete = false;
        hud.SetActive(false);
    }

    public void OnDeath() {
        gun.cooldownComplete = false;
        laser.cooldownComplete = false;
        hud.SetActive(false);
    }

    public void UpdateDamageUI(int damage) {
        playerDamageText.text = "-" + damage + " HP";
        StartCoroutine(Delay());
    }

    IEnumerator Delay() {
        yield return new WaitForSeconds(showDamageFor);
        playerDamageText.text = "";
    }
}