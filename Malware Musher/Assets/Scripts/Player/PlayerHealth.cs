using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class PlayerHealth : MonoBehaviour {

    public int maxHealth = 100;
    public int health;
    public AudioClip damageSound;
    public delegate void DamageDelegate(int damage);
    public event DamageDelegate damageEvent;
    [HideInInspector]
    public HealthObject healthObject;

    private LevelManager levelManager;
    private AudioSource audioSource;

    void Start() {
        levelManager = FindObjectOfType<LevelManager>();
        health = maxHealth;
        audioSource = GetComponent<AudioSource>();
    }
 
    void Update() {
        if (transform.position.y <= -100) {
            Die();
        }
        if (healthObject != null) {
            healthObject.Initialise(gameObject);
            healthObject = null;
        }
    }

    public void TakeDamage (int damage) {
        if (damageEvent != null)
            damageEvent(damage);
        health -= damage;
        if (health <= 0) {
            Die();
        } else {
            audioSource.PlayOneShot(damageSound);
        }
    }

    public void GainHealth (int healthIncrease) {
        health += healthIncrease;
        if (health > maxHealth) {
            health = maxHealth;
        }
    }

    public void Die() {
        levelManager.OnLevelDeath();
    }
}
