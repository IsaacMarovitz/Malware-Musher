using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;
using UnityEngine.UI;
using TMPro;

public class LevelSelectManager : MonoBehaviour {

    public GameObject menuInfo;
    public GameObject sliderMenu;
    public TMP_Text levelNameText;
    public TMP_Text buttonText;
    public Slider slider;
    public Button button;
    public LevelObjectClass levelObject;

    private LevelObjectClass blackLevelObjectClass;

    void Start() {
        levelObject = null;
    }

    void Update() {
        if (levelObject != null) {
            if (levelObject.sceneName == "Quit") {
                menuInfo.SetActive(true);
                levelNameText.text = levelObject.sceneName;
                buttonText.text = "Continue";
                button.onClick.RemoveAllListeners();
                button.onClick.AddListener(GameObject.Find("Game Manager").GetComponent<GameManager>().Quit);
                return;
            }
            menuInfo.SetActive(true);
            levelNameText.text = levelObject.sceneName;
            if (levelObject.hasBeenUnlocked) {
                button.interactable = true;
                buttonText.text = "Play";
            } else {
                button.interactable = false;
                buttonText.text = "Locked";
            }
        } else {
            menuInfo.SetActive(false);
        }
    }

    public void LoadLevel() {
        StartCoroutine(LoadSceneAsync(levelObject.sceneName));
    }

    IEnumerator LoadSceneAsync(string name) {
        AsyncOperation asyncLoad = SceneManager.LoadSceneAsync(name, LoadSceneMode.Single);
        menuInfo.SetActive(false);
        sliderMenu.SetActive(true);
        while (!asyncLoad.isDone) {
            float progress = Mathf.Clamp01(asyncLoad.progress / 0.9f);
            slider.value = progress;
            yield return null;
        }
    }
}
